name: å­¦æ ¡ä¿¡æ¯è‡ªåŠ¨å®¡æ ¸

on:
  issues:
    types: [opened, labeled]

# è®¾ç½®å¹¶å‘æ§åˆ¶ï¼Œç¡®ä¿å¯¹äºåŒä¸€ä¸ª issueï¼Œåªæœ‰ä¸€ä¸ª workflow å®ä¾‹åœ¨è¿è¡Œ
# issue å·ä½œä¸ºç»„åï¼Œcancel-in-progress: true è¡¨ç¤ºå¦‚æœæ–°çš„ workflow å¯åŠ¨ï¼Œä¼šè‡ªåŠ¨å–æ¶ˆåŒä¸€ç»„ä¸­æ­£åœ¨è¿è¡Œçš„æ—§ workflow
concurrency:
  group: ${{ github.workflow }}-${{ github.event.issue.number }}
  cancel-in-progress: true

jobs:
  process-school-issue: # job åç§°å¯ä»¥èµ·å¾—æ›´æ˜ç¡®ä¸€äº›
    runs-on: ubuntu-latest
    
    # 1. æƒé™æœ€å°åŒ–ï¼šç§»é™¤äº†ä¸å¿…è¦çš„ pull-requests: write æƒé™
    permissions:
      issues: write

    # 2. å°† if æ¡ä»¶æå‡åˆ° job çº§åˆ«ï¼šé¿å…é‡å¤ï¼Œæé«˜æ•ˆç‡å’Œå¯ç»´æŠ¤æ€§
    # 3. ä¿®æ­£é€»è¾‘ï¼šä½¿ç”¨æ‹¬å·ç¡®ä¿æ ‡é¢˜æ£€æŸ¥å¯¹ opened å’Œ labeled äº‹ä»¶éƒ½ç”Ÿæ•ˆ
    if: |
      contains(github.event.issue.title, 'å­¦æ ¡ä¿¡æ¯å¡«æŠ¥') &&
      (
        github.event.action == 'opened' ||
        (github.event.action == 'labeled' && github.event.label.name == 'å­¦æ ¡ä¿¡æ¯ç”³è¯·')
      )

    steps:
      # æ­¥éª¤ 1: è‡ªåŠ¨æ·»åŠ "å¾…å®¡æ ¸"æ ‡ç­¾
      # æ— éœ€å†å†™ ifï¼Œå› ä¸º job çº§åˆ«å·²ç»åˆ¤æ–­è¿‡äº†
      - name: è‡ªåŠ¨æ·»åŠ "å¾…å®¡æ ¸"æ ‡ç­¾
        uses: actions-ecosystem/action-add-labels@v1
        with:
          labels: å¾…å®¡æ ¸

      # æ­¥éª¤ 2: è‡ªåŠ¨è¯„è®ºæç¤º
      # åŒæ ·æ— éœ€å†å†™ if
      - name: è‡ªåŠ¨è¯„è®ºæç¤º
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ğŸ‘‹ æ„Ÿè°¢æäº¤å­¦æ ¡ä¿¡æ¯ï¼Œæˆ‘ä»¬å·²æ”¶åˆ°æ‚¨çš„ç”³è¯·ï¼Œè¯·è€å¿ƒç­‰å¾…å®¡æ ¸äººå‘˜å¤„ç†ã€‚
